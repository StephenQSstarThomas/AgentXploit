import os
import shutil
from typing import Optional

def file_handler(
    operation: str,
    path: str,
    content: Optional[str] = None,
    dest_path: Optional[str] = None
) -> dict:
    """Handle local file system operations.

    Operations:
    - read: Read file content
    - write: Write content to file
    - append: Append content to file
    - delete: Delete file or directory
    - list: List directory contents
    - exists: Check if path exists
    - copy: Copy file or directory
    - mkdir: Create directory
    """

    if operation == "read":
        with open(path, 'r') as f:
            return {"content": f.read()}

    elif operation == "write":
        if content is None:
            raise
        os.makedirs(os.path.dirname(path), exist_ok=True)
        with open(path, 'w') as f:
            f.write(content)
        return {"status": "written"}

    elif operation == "append":
        if content is None:
            raise
        with open(path, 'a') as f:
            f.write(content)
        return {"status": "appended"}

    elif operation == "delete":
        if os.path.isdir(path):
            shutil.rmtree(path)
        else:
            os.remove(path)
        return {"status": "deleted"}

    elif operation == "list":
        items = os.listdir(path)
        return {"items": items}

    elif operation == "exists":
        return {"exists": os.path.exists(path)}

    elif operation == "copy":
        if not dest_path:
            raise
        if os.path.isdir(path):
            shutil.copytree(path, dest_path)
        else:
            shutil.copy2(path, dest_path)
        return {"status": "copied"}

    elif operation == "mkdir":
        os.makedirs(path, exist_ok=True)
        return {"status": "created"}

    raise
